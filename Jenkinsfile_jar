podTemplate(label: 'mypod', containers: [
    containerTemplate(name: 'maven', image: 'emtrout/dind:latest', command: 'cat', ttyEnabled: true)
  ],
  volumes: [
    hostPathVolume(mountPath: '/var/run/docker.sock', hostPath: '/var/run/docker.sock'),
  ]) {
    node('mypod') {


        String GIT_SHORT_COMMIT

        stage ('GIT Checkout') {
            git branch: "master", url: 'https://github.com/emichaf/eiffel-intelligence-artifact-wrapper.git'

            GIT_SHORT_COMMIT = sh(returnStdout: true, script: "git log -n 1 --pretty=format:'%h'").trim()


        }

        stage('Maven Build') {
            container('maven') {
            withCredentials([[$class: 'UsernamePasswordMultiBinding',
                        credentialsId: '60cafeb7-9df5-47f5-a213-41713d632b7a',
                        usernameVariable: 'DOCKER_HUB_USER',
                        passwordVariable: 'DOCKER_HUB_PASSWORD']]) {


             sh "mvn clean package -DskipTests"

             }

            }
        }





    }
}